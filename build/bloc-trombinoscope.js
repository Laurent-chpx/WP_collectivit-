(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.blocks,o=window.wp.blockEditor,l=window.wp.components,r=window.wp.element,i=window.wp.apiFetch;var s=e.n(i);(0,n.registerBlockType)("wpcollectivites/trombinoscope",{title:"Trombinoscope",icon:"businessperson",category:"wp-collectivites",keywords:["trombinoscope","membre","equipe","municipale","élu"],attributes:{membre_id:{type:"number",default:0}},edit:({attributes:e,setAttributes:n})=>{const{membre_id:i}=e,[a,c]=(0,r.useState)([]),[m,d]=(0,r.useState)(null),[p,u]=(0,r.useState)(!0),[b,f]=(0,r.useState)(!1),[g,w]=(0,r.useState)("#ffffff");(0,r.useEffect)(()=>{window.wpcTrombinoscope&&window.wpcTrombinoscope.couleur_fond&&w(window.wpcTrombinoscope.couleur_fond),s()({path:"/wp/v2/membre-equipe-muni?per_page=100&orderby=title&order=asc"}).then(e=>{const t=[{label:"-- Sélectionner un membre --",value:0}];e.forEach(e=>{t.push({label:e.title.rendered,value:e.id})}),c(t),u(!1)}).catch(e=>{console.error("Erreur lors du chargement des membres:",e),u(!1)})},[]),(0,r.useEffect)(()=>{i&&0!==i?(f(!0),s()({path:`/wp/v2/membre-equipe-muni/${i}?_embed`}).then(e=>{const t={id:e.id,titre:e.title.rendered,fonction:e.meta?._wpc_fonction||"",infos_supp:e.meta?._wpc_informations_supplementaires||"",image:null};if(e._embedded&&e._embedded["wp:featuredmedia"]&&e._embedded["wp:featuredmedia"][0]){const n=e._embedded["wp:featuredmedia"][0];if(n.media_details&&n.media_details.sizes){const e=n.media_details.sizes.medium||n.media_details.sizes.full;e&&(t.image=e.source_url)}}d(t),f(!1)}).catch(e=>{console.error("Erreur lors du chargement des détails du membre:",e),f(!1),d({id:i,titre:"Membre sélectionné",fonction:"",infos_supp:"",image:null})})):d(null)},[i]);const E=(0,o.useBlockProps)({className:"bloc-trombinoscope",style:m?{backgroundColor:g}:{}});return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:"Sélection du membre",initialOpen:!0},p?(0,t.createElement)(l.Spinner,null):(0,t.createElement)(l.SelectControl,{label:"Membre à afficher",help:"Sélectionnez un membre de l'équipe municipale",value:i,options:a,onChange:e=>n({membre_id:parseInt(e)})}),(0,t.createElement)("div",{style:{marginTop:"20px",padding:"10px",backgroundColor:"#f0f0f0",borderRadius:"4px"}},(0,t.createElement)("p",{style:{margin:0,fontSize:"12px",color:"#666"}},(0,t.createElement)("strong",null,"Note :")," La couleur de fond du trombinoscope est définie dans les options générales du plugin."),(0,t.createElement)("p",{style:{margin:"5px 0 0 0",fontSize:"12px"}},"Couleur actuelle :",(0,t.createElement)("span",{style:{display:"inline-block",width:"20px",height:"20px",backgroundColor:g,border:"1px solid #ccc",borderRadius:"3px",verticalAlign:"middle",marginLeft:"5px"}})," ",g)))),(0,t.createElement)("div",{...E},m?b?(0,t.createElement)("div",{style:{textAlign:"center",padding:"40px"}},(0,t.createElement)(l.Spinner,null),(0,t.createElement)("p",null,"Chargement des informations...")):(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"bloc-trombinoscope--photo",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"300px",backgroundColor:"#f9f9f9"}},m.image?(0,t.createElement)("img",{src:m.image,alt:m.titre,style:{height:"100%",width:"auto",objectFit:"contain"}}):(0,t.createElement)("span",{className:"dashicons dashicons-businessperson",style:{fontSize:"150px",color:"#ccc"}})),(0,t.createElement)("div",{className:"bloc-trombinoscope--contenu",style:{textAlign:"center",padding:"20px"}},(0,t.createElement)("h3",null,m.titre),m.fonction&&(0,t.createElement)("p",{className:"bloc-trombinoscope--fonction"},(0,t.createElement)("strong",null,m.fonction)),m.infos_supp&&(0,t.createElement)("p",{className:"bloc-trombinoscope--infos",dangerouslySetInnerHTML:{__html:m.infos_supp}}),!m.fonction&&!m.infos_supp&&(0,t.createElement)("p",{style:{color:"#999",fontStyle:"italic"}},"Les informations détaillées seront affichées si elles sont renseignées dans la fiche du membre."))):(0,t.createElement)("div",{style:{padding:"40px 20px",backgroundColor:"#f0f0f0",border:"2px dashed #ccc",textAlign:"center",color:"#666"}},(0,t.createElement)("span",{className:"dashicons dashicons-businessperson",style:{fontSize:"48px",color:"#999"}}),(0,t.createElement)("p",{style:{marginTop:"10px",marginBottom:0}},(0,t.createElement)("strong",null,"Bloc Trombinoscope")),(0,t.createElement)("p",{style:{margin:"10px 0 0 0"}},"Veuillez sélectionner un membre de l'équipe municipale"))))},save:()=>null})})();